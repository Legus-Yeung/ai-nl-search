<!DOCTYPE html>
<html ng-app="nlSearchApp">
<head>
  <meta charset="UTF-8" />
  <title>AI Natural Language Search</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>

  <link rel="stylesheet" href="styles.css" />
</head>
<body ng-controller="SearchController">

  <h2>My Orders</h2>

  <input
    type="text"
    ng-model="query"
    placeholder="e.g. Show me all parcels delivered to Location A since January"
    style="width: 400px;"
    ng-keypress="$event.keyCode === 13 && search()"
  />

  <button ng-click="search()">Search</button>
  
  <p ng-if="error" style="color: red; margin-top: 10px;">{{ error }}</p>

  <p ng-if="loading">Searching…</p>

  <p ng-if="lastSearchQuery && !loading" style="font-size: 16px; color: #555; margin-top: 15px;">
    Search result for "<strong>{{ lastSearchQuery }}</strong>"
  </p>

  <div ng-if="followUp && followUp !== 'NO_ASSUMPTION_MADE'" style="background-color: #d1ecf1; border: 1px solid #0c5460; padding: 12px; margin: 15px 0; border-radius: 4px; color: #0c5460;">
    <strong>ℹ️ Note:</strong> {{ followUp }}
  </div>

  <div ng-if="warnings && warnings.length > 0" style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 10px; margin: 15px 0; border-radius: 4px;">
    <strong>⚠️ Warning:</strong>
    <ul style="margin: 5px 0; padding-left: 20px;">
      <li ng-repeat="warning in warnings">{{ warning }}</li>
    </ul>
  </div>

  <div ng-if="filters" style="margin: 15px 0;">
    <h3>Applied Filters</h3>
    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; border: 1px solid #dee2e6;">
      <div ng-if="getFilterSummary(filters).length > 0">
        <div ng-repeat="filter in getFilterSummary(filters)" style="margin: 5px 0;">
          <strong>{{ filter.label }}:</strong> {{ filter.value }}
        </div>
      </div>
      <div ng-if="getFilterSummary(filters).length === 0" style="color: #6c757d; font-style: italic;">
        No specific filters applied (showing all orders)
      </div>
    </div>
  </div>

  <h3 ng-if="results.length">Results ({{ results.length }})</h3>
  <div ng-if="results.length" style="overflow-x: auto;">
    <table border="1" style="min-width: 100%;">
      <thead>
        <tr>
          <th>Tracking No</th>
          <th>Order No</th>
          <th>Status</th>
          <th>Service</th>
          <th>Location</th>
          <th>Location Type</th>
          <th>City</th>
          <th>Company</th>
          <th>Carrier</th>
          <th>Collected By</th>
          <th>Compartment</th>
          <th>Recipient Phone</th>
          <th>Created</th>
          <th>Stored</th>
          <th>Collected</th>
          <th>Expires</th>
          <th>Flags</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="row in results">
          <td>{{ row.trackingNo }}</td>
          <td>{{ row.orderNo }}</td>
          <td><strong>{{ row.status }}</strong></td>
          <td>{{ row.service }}</td>
          <td>{{ row.locationName }}</td>
          <td>{{ row.locationType }}</td>
          <td>{{ row.city }}</td>
          <td>{{ row.companyName }}</td>
          <td>{{ row.carrierName || '-' }}</td>
          <td>{{ row.collectedByType || '-' }}</td>
          <td>{{ row.compartmentNo || '-' }}</td>
          <td>{{ row.recipientPhone }}</td>
          <td>{{ row.timeCreated | date:'yyyy-MM-dd HH:mm' }}</td>
          <td>{{ row.timeStored | date:'yyyy-MM-dd HH:mm' || '-' }}</td>
          <td>{{ row.timeCollected | date:'yyyy-MM-dd HH:mm' || '-' }}</td>
          <td>{{ row.expiresAt | date:'yyyy-MM-dd HH:mm' || '-' }}</td>
          <td>{{ row.flags || '-' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="app.js"></script>
</body>
</html>
